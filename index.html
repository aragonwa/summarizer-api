<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <title>Summarizer Demo + Spinner + Progress Bar</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 800px;
      margin: 40px auto;
      padding: 20px;
      line-height: 1.6;
    }

    textarea {
      width: 100%;
      height: 200px;
      padding: 10px;
    }

    button {
      padding: 10px 16px;
      margin: 10px 8px 10px 0;
      font-size: 14px;
      cursor: pointer;
    }

    #summary {
      background: #f7f7f7;
      padding: 12px;
      white-space: pre-wrap;
      border: 1px solid #ddd;
      margin-top: 20px;
      min-height: 50px;
    }

    #status {
      font-weight: bold;
      margin-bottom: 12px;
      color: #444;
    }

    /* Progress Bar */
    #progressContainer {
      width: 100%;
      background: #eee;
      height: 16px;
      border-radius: 8px;
      overflow: hidden;
      margin-top: 10px;
      display: none;
    }

    #progressBar {
      height: 100%;
      width: 0%;
      background: #4a90e2;
      transition: width 0.4s ease;
    }

    /* Spinner */
    #spinner {
      display: none;
      margin-top: 20px;
      text-align: center;
    }

    .loader {
      border: 6px solid #eee;
      border-top: 6px solid #4a90e2;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
      margin: auto;
    }

    @keyframes spin {
      0% {
        transform: rotate(0deg);
      }

      100% {
        transform: rotate(360deg);
      }
    }
  </style>
</head>

<body>

  <h1>Summarizer API Demo</h1>

  <div id="status">Checking browser support...</div>

  <textarea id="inputText"
    placeholder="Paste or type text here...">As remote work becomes increasingly common, companies are rethinking how to design effective hybrid collaboration models. While digital tools like video conferencing and shared whiteboards make teamwork possible across distances, many teams still struggle with communication overload and meeting fatigue. Research shows that hybrid teams perform best when they establish clear communication norms, schedule focused work periods, and reduce unnecessary synchronous meetings. Some companies are now adopting ‚Äúasync-first‚Äù policies, allowing employees to contribute on their own time while reserving real-time meetings for high-impact discussions.</textarea>

  <div>
    <button onclick="runSummary('tldr')">TL;DR</button>
    <button onclick="runSummary('key-points')">Key Points</button>
    <button onclick="runSummary('paragraph')">Paragraph Summary</button>
  </div>

  <!-- Model Loading Progress Bar -->
  <div id="progressContainer">
    <div id="progressBar"></div>
  </div>

  <!-- Spinner for summarizing -->
  <div id="spinner">
    <div class="loader"></div>
    <p>Generating summary...</p>
  </div>

  <h3>Summary Output</h3>
  <div id="summary">Your summary will appear here.</div>

  <script>
    let available = false;

    async function checkSupport() {
      if (!("Summarizer" in self)) {
        document.getElementById("status").textContent =
          "‚ùå Summarizer API not supported in this browser.";
        return;
      }

      const state = await Summarizer.availability();
      if (state === "unavailable") {
        document.getElementById("status").textContent =
          "‚ùå Summarizer unavailable on this device.";
        return;
      }

      document.getElementById("status").textContent =
        "‚úÖ Summarizer API available!";
      available = true;
    }

    checkSupport();

    function updateProgress(percent) {
      const container = document.getElementById("progressContainer");
      const bar = document.getElementById("progressBar");

      container.style.display = "block";
      bar.style.width = percent + "%";
    }

    function hideProgress() {
      document.getElementById("progressContainer").style.display = "none";
      document.getElementById("progressBar").style.width = "0%";
    }

    function showSpinner() {
      document.getElementById("spinner").style.display = "block";
    }

    function hideSpinner() {
      document.getElementById("spinner").style.display = "none";
    }

    async function runSummary(type) {
      if (!available) {
        alert("Summarizer API not supported on this browser.");
        return;
      }

      const text = document.getElementById("inputText").value.trim();
      if (!text) {
        document.getElementById("summary").textContent = "Please enter text.";
        return;
      }

      const output = document.getElementById("summary");
      output.textContent = "";

      hideProgress();
      hideSpinner();

      let summarizer;

      try {
        // Create Summarizer with progress events
        summarizer = await Summarizer.create(
          { type, format: "plain-text", length: "medium", lang: "en" },
          {
            onstatechange: (state) => {
              if (state === "initializing") updateProgress(10);
              if (state === "model-fetch") updateProgress(40);
              if (state === "model-compile") updateProgress(75);
              if (state === "ready") hideProgress();
            }
          }
        );

        // üîÑ Show spinner during actual summarization
        showSpinner();

        // const summary = await summarizer.summarize(text);
        // ‚ö° STREAMING SUMMARY
        const stream = await summarizer.summarizeStreaming(text);

        for await (const chunk of stream) {
          // Each "chunk" is a piece of the generated text
          console.log("Received chunk:", chunk);
          output.textContent += chunk;
        }

        hideSpinner();
        // output.textContent = summary;

      } catch (err) {
        hideSpinner();
        hideProgress();
        output.textContent = "‚ö†Ô∏è Error: " + err.message;
      } finally {
        if (summarizer) summarizer.destroy();
      }
    }
  </script>
</body>

</html>